<!DOCTYPE html>
<html lang="en">
<head>

<script src="../dist/libssh2.js"></script>
<script>
	let SESSION;
	Module().then((libssh2) => {
		console.log(libssh2);
		SESSION = libssh2._SESSION;

		libssh2.init(0);

		test();
	});

let session;
function test()
{
	//console.log('test');
	const url = 'ws://127.0.0.1:7681/xxx';
	const ws = new WebSocket(url);
	ws.binaryType = 'arraybuffer';
	
	ws.onopen = function() {
		console.log('WebSocket opened');
	}

	ws.onerror = function(e) {
		console.error('WebSocket error', e);
	}
	ws.onclose = function() {
		console.error('WebSocket closed');

		delete session;
	}
	
	ws.onmessage = function(e)  {
		//console.log('got', e.data);
		session.pushdata(e.data);
	}

	session = new SESSION(ws);

	session.send = function(buffer, length) {
		//console.log('to raw', length, buffer.length);
		ws.send(buffer);
	}
}

</script>
</head>
<body>
</body>
</html>
